{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/program/python/auto-self-retweert/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Mushroom Records"}},"markdownRemark":{"id":"b97c9dc6-3d9e-5618-9062-c1b721a61705","excerpt":"…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f4312f1cddac231f4b85b1faa9f58bd/21b4d/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByklEQVQoz42SPWhUQRSFv7fvJbsobKHRxc0d86OBSMIGi1SxEKxsRCwkhGAjQiAgwpZWio2FqAhiZqKJKaIQRbATxFIsUlpYBcUiILozLGLQFCPz3v7BZsULl3k8Zj7OvecAoIxDjEtPZVxOGYtoi3ryKxpa99zynqz6aVWO3hUA7XYoHdomamWHoWd+fzUDlojyx4ByeELCcWBfD6BrwvKi3QXRNk5VL9Vm1XL96+D9z++L567fA2YLp4o3+sbzV4ErRCz2BIpuKDP2nTLug2h7XrTdVMZ50d99qfrt9EhtYG54a/LSyPaJawdulkoB2jeej7uA6f60jcLexLhVMc5nIOvV45+75TufPMzIpJ+YHq1XLo75yvyYrxSB+T2BTTMysJsWbeti3B9Z+vH76NquP7jw9AvwCuKH8eFkBQjjbwAP9jQnGzndYaSMHRRtX4ixXnTNq9Wdt4WpsycBQ5R7CQSHNoHnQWEDEXW5nI2bQmeUcY+UsWvKuMtHbn/sP1R93bw6CrwBFuCfscly2Nhl9q2zXJbvbjGwuB4Gi4mTTiVJl7K2KbbVwRxlbAh3LGk7hjd85/VcT1BLobadWWzHqPGvMHGG/62/im3VaJe9+7AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0\"\n        title=\"0\"\n        src=\"/static/0f4312f1cddac231f4b85b1faa9f58bd/f058b/0.png\"\n        srcset=\"/static/0f4312f1cddac231f4b85b1faa9f58bd/c26ae/0.png 158w,\n/static/0f4312f1cddac231f4b85b1faa9f58bd/6bdcf/0.png 315w,\n/static/0f4312f1cddac231f4b85b1faa9f58bd/f058b/0.png 630w,\n/static/0f4312f1cddac231f4b85b1faa9f58bd/40601/0.png 945w,\n/static/0f4312f1cddac231f4b85b1faa9f58bd/78612/0.png 1260w,\n/static/0f4312f1cddac231f4b85b1faa9f58bd/21b4d/0.png 1280w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1>概要</h1>\n<p>いちいちリツイートボタンを押しに行くのがめんどくさいので、\nせや！自動化したろ！というおはなし。</p>\n<h1>リツイート何度も繰り返すのは案外めんどくさい</h1>\n<p>僕は音楽とかそういったのを作るのがすきなんですけど、<br>\n先日、新曲を発表しました。<br>\n宣伝になりますが、ぜひ聞いてみてください。</p>\n<!-- <iframe width=\"1280\" height=\"720\" src=\"https://www.youtube.com/embed/KFBYnI13tKk\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe> -->\n<p>…</p>\n<p><strong>これ何度も宣伝するのめんどくさくね？</strong><br>\n…とふと思いました。<br>\nめんどくさいので、じゃあ自動化しましょう。</p>\n<h1>Twitter API 使えるように準備</h1>\n<h2>Twitter API 使用権限を用意する</h2>\n<p>このへんを参考に取得してください。</p>\n<blockquote>\n<ul>\n<li><a href=\"https://qiita.com/kngsym2018/items/2524d21455aac111cdee\">Twitter API 登録 (アカウント申請方法) から承認されるまでの手順まとめ　※2019 年 8 月時点の情報 - Qiita</a></li>\n</ul>\n</blockquote>\n<p>取得したものを、とりあえずわかりやすく<code class=\"language-text\">key.py</code>にぶちこんでおきましょう。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>key.py</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">API_KEY <span class=\"token operator\">=</span> <span class=\"token string\">'hoge'</span>\nAPI_SECRET <span class=\"token operator\">=</span> <span class=\"token string\">'hoge'</span>\nACCESS_TOKEN <span class=\"token operator\">=</span> <span class=\"token string\">'hoge'</span>\nACCESS_TOKEN_SECRET <span class=\"token operator\">=</span> <span class=\"token string\">'hoge'</span></code></pre></div>\n<p>次に<code class=\"language-text\">Twitter_API.py</code>を作成して、API を使えるようにしましょう。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>Twitter_api.py</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">\n<span class=\"token keyword\">import</span> key\n\nAPI_KEY <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>API_KEY\nAPI_SECRET <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>API_SECRET\nACCESS_TOKEN <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>ACCESS_TOKEN\nACCESS_TOKEN_SECRET <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>ACCESS_TOKEN_SECRET\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">api_proc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># TwiterのAPIを使えるようにする</span>\n    api <span class=\"token operator\">=</span> OAuth1Session<span class=\"token punctuation\">(</span>\n        API_KEY<span class=\"token punctuation\">,</span>\n        API_SECRET<span class=\"token punctuation\">,</span>\n        ACCESS_TOKEN<span class=\"token punctuation\">,</span>\n        ACCESS_TOKEN_SECRET\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> api</code></pre></div>\n<p>これで <code class=\"language-text\">Twitter_api.api_proc()</code>を実行すると返り値として Twitter の API 使用権限が渡されます。</p>\n<h1>実際に API を動かしてみよう</h1>\n<h2>やりたいことをまとめる</h2>\n<p>したいことをわかりやすくまとめるとこうなります。</p>\n<ul>\n<li>指定したツイート ID を、自分のアカウントで RT 解除する。</li>\n<li>指定したツイート ID を、自分のアカウントで RT する。</li>\n</ul>\n<p>なぜ解除が必要か？と言うと、同じツイートを 2 回リツイートすることはできないので、<br>\n同じツイートをリツイートしたい場合は一度解除する必要があるからです。<br>\nちなみに、エラーなどは一切発生しません。(厳密には exception が発生しない)</p>\n<h2>当該ツイートの ID を取得する</h2>\n<p>Twitter の当該ツイートのページへ飛びます。<br>\nPC なら適当なツイートのどこでもいいのでクリックすれば飛ぶと思います。<br>\nそうでない場合、だいたい日付をクリックすれば当該ツイートへ移動できます。</p>\n<p>そのページの URL は以下の通りになっていると思います。</p>\n<blockquote>\n<p><code class=\"language-text\">https://twitter.com/MushroomRecord/status/1346128262871744512</code></p>\n</blockquote>\n<p>これの<code class=\"language-text\">status</code>の右側、つまりこの URL だと<code class=\"language-text\">1346128262871744512</code>が該当 ID となります。<br>\nこれを使用するので控えておきましょう。</p>\n<h2>API を動かす</h2>\n<p>今回は<code class=\"language-text\">POST</code>で API を動かすだけで簡単に終わるので、<br>\nスクリプトも簡単になります。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>main.py</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> Twitter_API\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>tweet_id<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    TWITTER <span class=\"token operator\">=</span> Twitter_API<span class=\"token punctuation\">.</span>api_proc<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    URL_TWITTER <span class=\"token operator\">=</span> <span class=\"token string\">'https://api.twitter.com/1.1/statuses'</span>\n    URL_RT <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f'</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>URL_TWITTER<span class=\"token punctuation\">}</span></span><span class=\"token string\">/retweet/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>tweet_id<span class=\"token punctuation\">}</span></span><span class=\"token string\">.json'</span></span>\n    URL_UNRT <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f'</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>URL_TWITTER<span class=\"token punctuation\">}</span></span><span class=\"token string\">/unretweet/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>tweet_id<span class=\"token punctuation\">}</span></span><span class=\"token string\">.json'</span></span>\n\n    TWITTER<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>URL_UNRT<span class=\"token punctuation\">)</span>\n    TWITTER<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>URL_RT<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    tweet_id <span class=\"token operator\">=</span> <span class=\"token number\">1346128262871744512</span>\n    main<span class=\"token punctuation\">(</span>tweet_id<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>これを実行すると、僕の宣伝ツイートが RT されると思います。<br>\n<code class=\"language-text\">tweet_id</code>を変更すれば非公開アカウントでない限りどんなツイートも RT することができるはずです。</p>\n<h1>どうせ起動している PC を使って定期的に実行する</h1>\n<p>僕はずっと PC もとい Mac をつけっぱなしにしているので、<br>\nこのズボラな点を使って定期的に実行できるようにします。</p>\n<p><code class=\"language-text\">cron</code>とかあったよなーと思いつつも調べたら、<br>\nMac だと<code class=\"language-text\">Launchd</code>のほうが良いみたいです、よくわからんけど。</p>\n<p>というわけで<code class=\"language-text\">Launchd</code>を使って定期実行を行います。</p>\n<div class=\"gatsby-highlight\" data-language=\"xml:autoself_retweet.plist\"><pre class=\"language-xml:autoself_retweet.plist\"><code class=\"language-xml:autoself_retweet.plist\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;!DOCTYPE plist PUBLIC &quot;-//Apple Computer//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;\n&lt;plist version=&quot;1.0&quot;&gt;\n    &lt;dict&gt;\n        &lt;key&gt;Label&lt;/key&gt;\n        &lt;string&gt;autoself_retweet&lt;/string&gt;\n\n        &lt;key&gt;ProgramArguments&lt;/key&gt;\n        &lt;array&gt;\n            &lt;string&gt;pythonのパス&lt;/string&gt;\n            &lt;string&gt;スクリプトのパス&lt;/string&gt;\n        &lt;/array&gt;\n\n        &lt;key&gt;StartInterval&lt;/key&gt;\n        &lt;integer&gt;3600&lt;/integer&gt;\n\n    &lt;/dict&gt;\n&lt;/plist&gt;\n</code></pre></div>\n<p><code class=\"language-text\">key</code>と<code class=\"language-text\">なんかの属性</code>がセットになっていると考えながら構築します。</p>\n<ul>\n<li>\n<p><code class=\"language-text\">Label</code>は任意の名前をセットします。<br>\n<strong><code class=\"language-text\">Label</code>と<code class=\"language-text\">ファイル名</code>は同一である必要があります。</strong></p>\n</li>\n<li>\n<p><code class=\"language-text\">ProgramArguments</code>に実行したいコマンドとパラメータを入れます。</p>\n<blockquote>\n<p>ここがよくわからなくて、本当は「cd で移動して、そこのスクリプトを読み込んで〜」と汎用性ある記述にしたかったんですが、<br>\nうまく行かなかったので、実用性重視でコマンドとして一行にまとめるような記述になってるんですが、<br>\n詳しい方いたらご教授いただけると幸いです。</p>\n</blockquote>\n</li>\n<li>\n<p><code class=\"language-text\">StartInterval</code>で何秒おきに実行するかを決めます。</p>\n</li>\n</ul>\n<h2>定期実行できるようにセットする</h2>\n<p>これで n 秒おきに Python スクリプトを実行する環境が整ったので、実際に Mac に仕込みます。</p>\n<ul>\n<li><code class=\"language-text\">~/Library/LaunchAgents</code>に<code class=\"language-text\">autoself_retweet.plist</code>を設置します。</li>\n<li>ターミナルで以下コマンドを入力すると、定期実行が開始されます。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"zsh:terminal\"><pre class=\"language-zsh:terminal\"><code class=\"language-zsh:terminal\">$ launchctl load ~/Library/LaunchAgents/autoself_retweet.plist</code></pre></div>\n<ul>\n<li>もし、上記手順を踏んでもスクリプトが実行されない、テストに失敗していると思ったときは以下コマンドで unload します。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"zsh:terminal\"><pre class=\"language-zsh:terminal\"><code class=\"language-zsh:terminal\">$ launchctl unload ~/Library/LaunchAgents/autoself_retweet.plist</code></pre></div>\n<p>それでは、良い定期実行ライフを。</p>\n<h1>参考</h1>\n<p><a href=\"https://qiita.com/rsahara/items/7d37a4cb6c73329d4683\">launchd で定期的にスクリプトを実行 - Qiita</a></p>","frontmatter":{"title":"どうせ起動してるPCを使って、宣伝ツイートを自動でRTする","date":"2021/01","description":"Music"}}},"pageContext":{"id":"b97c9dc6-3d9e-5618-9062-c1b721a61705","previousPostId":"53abee52-0211-51e2-af8d-a009ed880631","nextPostId":"48612d8a-fad4-59da-b1ee-4a5bb3e4afc7"}},
    "staticQueryHashes": ["3713412316"]}