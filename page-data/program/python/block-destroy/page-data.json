{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/program/python/block-destroy/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Mushroom Records"}},"markdownRemark":{"id":"148eabe6-c811-5066-ab85-f4533fa61bfd","excerpt":"概要 Twitter API を利用して積もり積もったブロックを一斉に解除する Twitter、楽しんでますか？ どうも、2010 年くらいから Twitter やってるけどアカウント一回消したので 2013 年からやってるみたいに見えるけど割と古参なツイッタラー Sotono です。 Twitter…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmUlEQVQoz5WSzStEURjG35krK5GE6JzrY2HFhpWSjY80rpGYa6GUrw0LpuyUnVlgMYnUe+bOzsI/YGdnh+ykxp1hmA3NPSefSTm65w4NG9dTT2+95/Q7zznnBfglygQQZQ4EeZCgql7fq0F3jTKv96e+YO5mD861ImBZUV9B/xRlIlA4vYkyMUC+EwvU0bluQCdJmGhwexR5wEdCHlCJkLcQJvIU+TZhYkJH/lFnPcra5PNF+851RdtuDpox7wfoJlTXqqJM5AgTkiKXNYmnt9a4Lbtip9bS2gFMbR5pEnyIFh6+AF3R0XFhL93x8/eT5VV5s7h4n5me6czNTsPV7FzQzxsCReUSwnhXI+azldarnIkdyjfckXeMyez8QvRmKQq30WiJP6DnUsrEJEW+V5942O7YsvszxmA8FQ5bKcMot0MhsIeG/PwyL4aCjg7UWM/Qu3EG6d4eSPX1wWV4GGzDUP5PQjVCOjpatfWihdaPg9mxUS1tmpptmpCORCBtmn4+RfyEeiMEsC8hNzoCtjkOmUhE2YX+1idx5PMK/hRIlQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0\"\n        title=\"0\"\n        src=\"/static/8d9a1d788be1911693fc824391ce6267/f058b/0.png\"\n        srcset=\"/static/8d9a1d788be1911693fc824391ce6267/c26ae/0.png 158w,\n/static/8d9a1d788be1911693fc824391ce6267/6bdcf/0.png 315w,\n/static/8d9a1d788be1911693fc824391ce6267/f058b/0.png 630w,\n/static/8d9a1d788be1911693fc824391ce6267/40601/0.png 945w,\n/static/8d9a1d788be1911693fc824391ce6267/78612/0.png 1260w,\n/static/8d9a1d788be1911693fc824391ce6267/21b4d/0.png 1280w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1>概要</h1>\n<ul>\n<li>Twitter API を利用して積もり積もったブロックを一斉に解除する</li>\n</ul>\n<h1>Twitter、楽しんでますか？</h1>\n<p>どうも、2010 年くらいから Twitter やってるけどアカウント一回消したので 2013 年からやってるみたいに見えるけど割と古参なツイッタラー Sotono です。<br>\nTwitter、スマホの普及でインターネット人口が爆発的に増えてやってる人が無茶苦茶増えましたよね。<br>\n…まあその分目につくアカウントも爆発的に増えたのでブロック機能も大活躍〜って感じなのですが…</p>\n<p>ところでこれは宣伝なんですけども、趣味で作っている音楽の新曲を発表しました。<br>\n本筋とはちょっとしか関係ありませんが、どうぞ聴いてみてください。</p>\n<p><a href=\"https://t.co/JecryTf2lX?amp=1\">ここを押すと Youtube に飛びます</a></p>\n<h1>嫌なものに蓋をする行為としてのブロック</h1>\n<p>僕は以前、<strong>ワードで検索をかけて、引っかかったユーザーをすべてブロックする</strong>というスクリプトを制作した経験があります。 (記事にはしていませんが)</p>\n<p>その目的は単純明快で、「 <strong>見たくないものに蓋をしたかった</strong> 」ということなんですね。<br>\nただ、こちらから蓋をすると向こうからも見えなくなるといったデメリットがブロック機能にはございまして、<br>\n僕はこのスクリプトを使って<strong>100 万人弱のアカウントをブロック</strong>してきました。<a href=\"https://getnews.jp/archives/1452871/gate\">おふがお氏リスペクト</a>かなにか？</p>\n<p>嫌なワードをミュートすればいいじゃんって話なんですが、実はワードミュート、活用してます。<br>\nじゃあなんでそんな数ブロックしたのかといいますと、「 <strong>そんなことを言ってるやつは他のことを言わせてもロクなことを言わない</strong> 」と思ったからなんですね。</p>\n<p>例えば話題 A が嫌いで、「そんな話題ききとうない！！」とワードミュートしてても、<br>\nその人が話題 B を発言しても似たようなニュアンスのことが多いんですね。<br>\nなので「話題 A 嫌じゃ！そんな事を言うやつは話題 B でも同じこと言う！！」とブロック、という感じです。<br>\nいわゆる<strong>先行ブロック</strong>と呼ばれる行為にあたります。</p>\n<h1>ブロックの何がいけないの？</h1>\n<p>ところで、このブロックという行為、ひとつデメリットがあります。<br>\nそれはもちろん、これですよね。</p>\n<ul>\n<li>人を拒絶するため、見てもらえるコンテンツが見てもらえなくなる</li>\n</ul>\n<p>これに尽きると思います。<br>\nここでさっき宣伝した曲が出てくるんですが、もしかしたら</p>\n<p>「<strong>曲が伸びないのは、自分が 100 万弱の人間をブロックしているからなのでは？</strong>」</p>\n<p>と思ったんですね。<br>\nTwitter のアクティブユーザーが予想で 1 億人いるとして、1%に満たない数字だとしても、100 万人の人には届かない。</p>\n<p>これはいけない…<br>\nブロック解除しなくちゃ…でも 100 万人もポチポチするの嫌じゃ…</p>\n<p>そうだ、API でなんとかならないか！？</p>\n<h1>な　り　ま　し　た</h1>\n<p>では本題です。<br>\n<strong>Python を用いて Twitter の API を使ってブロックを全部解除</strong>していきましょう。<br>\n<del>なんで Python？それしか使えないからだよ</del></p>\n<p>まず用意するものはこちら。</p>\n<h2>Twitter API 使用権限を用意する</h2>\n<p>このへんを参考に取得してください。</p>\n<blockquote>\n<ul>\n<li><a href=\"https://qiita.com/kngsym2018/items/2524d21455aac111cdee\">Twitter API 登録 (アカウント申請方法) から承認されるまでの手順まとめ　※2019 年 8 月時点の情報 - Qiita</a></li>\n</ul>\n</blockquote>\n<p>取得したものを、とりあえずわかりやすく<code class=\"language-text\">key.py</code>にぶちこんでおきましょう。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>key.py</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">API_KEY <span class=\"token operator\">=</span> <span class=\"token string\">'hoge'</span>\nAPI_SECRET <span class=\"token operator\">=</span> <span class=\"token string\">'hoge'</span>\nACCESS_TOKEN <span class=\"token operator\">=</span> <span class=\"token string\">'hoge'</span>\nACCESS_TOKEN_SECRET <span class=\"token operator\">=</span> <span class=\"token string\">'hoge'</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">api</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># TwiterのAPIを使えるようにする</span>\n    api <span class=\"token operator\">=</span> OAuth1Session<span class=\"token punctuation\">(</span>\n        API_KEY<span class=\"token punctuation\">,</span>\n        API_SECRET<span class=\"token punctuation\">,</span>\n        ACCESS_TOKEN<span class=\"token punctuation\">,</span>\n        ACCESS_TOKEN_SECRET\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> api\n</code></pre></div>\n<p>これで <code class=\"language-text\">key.api()</code>を実行すると返り値として Twitter の API 使用権限が渡されます。</p>\n<h1>実際に API を動かしてみよう</h1>\n<p>最終的にしたいことを箇条書きにするとこうなります。</p>\n<ul>\n<li>ブロックした人間のリストを取得する</li>\n<li>片っ端からブロックを解除する</li>\n</ul>\n<p>とりあえずスクリプトの名前は API の名前からとって<code class=\"language-text\">block_destroy.py</code>としましょう。</p>\n<h2>ブロックした人間のリストを取得する関数を作る</h2>\n\n        <div class=\"gatsby-code-title\">\n          <span>block_destroy.py</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">\n<span class=\"token keyword\">import</span> key\n<span class=\"token keyword\">import</span> json\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_ids</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    twitter <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>api_proc<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    url <span class=\"token operator\">=</span> <span class=\"token string\">'https://api.twitter.com/1.1/blocks/ids.json'</span>\n    res <span class=\"token operator\">=</span> twitter<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n    id_dict <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span>\n    ids <span class=\"token operator\">=</span> id_dict<span class=\"token punctuation\">[</span><span class=\"token string\">'ids'</span><span class=\"token punctuation\">]</span>\n    twitter<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> ids</code></pre></div>\n<h3>解説 1</h3>\n<ul>\n<li><code class=\"language-text\">https://api.twitter.com/1.1/blocks/ids.json</code>を GET して<code class=\"language-text\">res</code>を取得。</li>\n</ul>\n<blockquote>\n<p>これは、ブロックしたアカウントを id リストとして出力するような API アドレス。</p>\n</blockquote>\n<ul>\n<li><code class=\"language-text\">res</code>の中にある<code class=\"language-text\">text</code>を引っ張り出す。</li>\n<li><code class=\"language-text\">text</code>は json 形式なので<code class=\"language-text\">json.loads()</code>で辞書型に変換。</li>\n<li>ほしいのは辞書ではなく配列なので、辞書に格納されている配列を<code class=\"language-text\">'ids'</code>で取り出す。</li>\n<li><code class=\"language-text\">return</code>で関数の外へ引っ張り出す。\n<blockquote>\n<p>ちなみにこれで取得できるアカウントの件数は一度に 5000 件。</p>\n</blockquote>\n</li>\n</ul>\n<h2>id をもとにブロックを解除する関数を作る</h2>\n\n        <div class=\"gatsby-code-title\">\n          <span>block_destroy.py</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> key\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span>_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    twitter <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span>api_proc<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    url <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f'https://api.twitter.com/1.1/blocks/destroy.json'</span></span>\n    params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'user_id'</span><span class=\"token punctuation\">:</span> _id<span class=\"token punctuation\">}</span>\n    twitter<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> params<span class=\"token operator\">=</span>params<span class=\"token punctuation\">)</span>\n\n    twitter<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>解説 2</h3>\n<ul>\n<li><code class=\"language-text\">https://api.twitter.com/1.1/blocks/destroy.json</code></li>\n</ul>\n<blockquote>\n<p>これは、パラメーター付与して POST すると、そのアカウントのブロックを解除する API アドレス。</p>\n</blockquote>\n<ul>\n<li>関数<code class=\"language-text\">destroy</code>にユーザーの ID を渡すとブロックを解除するように作る。</li>\n<li><code class=\"language-text\">params</code>でパラメーターを定義し、id をそこに付与する。</li>\n<li>URL にパラメーターを付与して POST、ブロックの解除が成立する。</li>\n</ul>\n<h2>ふたつの関数をつなぎ合わせる関数を作る</h2>\n\n        <div class=\"gatsby-code-title\">\n          <span>block_destroy.py</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> tqdm <span class=\"token keyword\">import</span> tqdm\n<span class=\"token keyword\">from</span> multiprocessing <span class=\"token keyword\">import</span> Pool\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    ids <span class=\"token operator\">=</span> get_ids<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>ids<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n        exit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    pool <span class=\"token operator\">=</span> Pool<span class=\"token punctuation\">(</span>processes<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-'</span> <span class=\"token operator\">*</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">with</span> tqdm<span class=\"token punctuation\">(</span>total<span class=\"token operator\">=</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> t<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> pool<span class=\"token punctuation\">.</span>imap_unordered<span class=\"token punctuation\">(</span>destroy<span class=\"token punctuation\">,</span> ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            t<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>解説 3</h3>\n<ul>\n<li><code class=\"language-text\">get_ids</code>でアカウント ID を 5000 件取得。</li>\n<li><code class=\"language-text\">if</code>…もしアカウント ID が 0 件だったら<code class=\"language-text\">exit()</code>処理を終了する。</li>\n</ul>\n<blockquote>\n<p>この処理を入れるのは、前述したとおり、一度に取得できるアカウント ID の個数が 5000 件のため。<br>\nnext cursor？そんなの知らない！</p>\n</blockquote>\n<ul>\n<li><code class=\"language-text\">pool</code>でサブプロセスを起動して処理の並列化を行い、高速化を図る</li>\n<li>ついでに<code class=\"language-text\">tqdm</code>で進捗をわかりやすくする</li>\n<li><code class=\"language-text\">destroy</code>関数を実行し、<code class=\"language-text\">ids</code>の中身を順番に渡すことでブロック解除を行う</li>\n<li>以下ブロック件数 0 になるまで無限ループ</li>\n</ul>\n<h1>これでスッキリ全員ブロックできた</h1>\n<blockquote class=\"twitter-tweet\"><p lang=\"ja\" dir=\"ltr\">なんというか…清々しい気分だ… <a href=\"https://t.co/kYaQJLezW2\">pic.twitter.com/kYaQJLezW2</a></p>&mdash; Sotono / 爪楊枝 (@_Sotono) <a href=\"https://twitter.com/_Sotono/status/1321277104076386305?ref_src=twsrc%5Etfw\">October 28, 2020</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n<p>おわり。</p>\n<h1>参考</h1>\n<ul>\n<li><a href=\"https://syncer.jp/Web/API/Twitter/REST_API/\">Twitter REST API の使い方</a></li>\n<li><a href=\"https://qiita.com/namahoge/items/c390e79693605234212b\">ちょっとかしこい tqdm② ~ multiprocessing 編 ~ - Qiita</a></li>\n</ul>","frontmatter":{"title":"Twitterのブロックを一斉に解除しようの巻","date":"2020/10","description":"Python,Twitter"}}},"pageContext":{"id":"148eabe6-c811-5066-ab85-f4533fa61bfd","previousPostId":"03242f15-8e95-52e1-ac6e-d33156f6cabd","nextPostId":"c84bbeb4-185c-5c2d-a1c0-b94f59a13b9f"}},
    "staticQueryHashes": ["3713412316"]}